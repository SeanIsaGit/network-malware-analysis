import subprocess
import os

UPLOAD_FOLDER = '/home/sean/Downloads'

cwd = os.getcwd()
print(cwd)
os.chdir(UPLOAD_FOLDER)

process = subprocess.Popen(['/opt/zeek/bin/zeek', '-C', '-r', f"{UPLOAD_FOLDER}/combined_file_test.pcap",
                            'file-extraction/plugins/extract-all-files'],
                           stdout=subprocess.PIPE,
                           stderr=subprocess.PIPE)
stdout, stderr = process.communicate()
print(stdout, stderr)

os.chdir(f"{UPLOAD_FOLDER}/extract_files")
cwd = os.getcwd()
file_paths = []
for filename in os.listdir(cwd):
    f = os.path.join(cwd, filename)
    # checking if it is an executable file
    if os.path.isfile(f) and f.endswith(".exe"):
        file_paths.append(f)

print(file_paths)
